# å¤©æ°”APIæ–‡æ¡£

åŸºäºå’Œé£å¤©æ°”APIæ„å»ºçš„Next.jså¤©æ°”æœåŠ¡æ¥å£ï¼Œå®Œå…¨ç¬¦åˆå’Œé£å¤©æ°”å®˜æ–¹APIè§„èŒƒã€‚

## ğŸŒ åŸºç¡€ä¿¡æ¯

- **åŸºç¡€URL**: `/api/weather`
- **æ”¯æŒæ ¼å¼**: JSON
- **è®¤è¯æ–¹å¼**: ç¯å¢ƒå˜é‡é…ç½®APIå¯†é’¥

## ğŸ“‹ é€šç”¨å‚æ•°è¯´æ˜

### ä½ç½®å‚æ•° (location)

æ”¯æŒä¸¤ç§æ ¼å¼ï¼š

- **LocationID**: æ•°å­—æ ¼å¼ï¼Œå¦‚ `101010100`ï¼ˆåŒ—äº¬ï¼‰
- **åæ ‡æ ¼å¼**: `ç»åº¦,çº¬åº¦`ï¼Œå¦‚ `116.41,39.92`ï¼ˆæœ€å¤šæ”¯æŒå°æ•°ç‚¹åä¸¤ä½ï¼‰

### å¤šè¯­è¨€è®¾ç½® (lang)

æ”¯æŒçš„è¯­è¨€ä»£ç ï¼š

- `zh`: ä¸­æ–‡ï¼ˆé»˜è®¤ï¼‰
- `zh-hk`: ä¸­æ–‡ç¹ä½“
- `en`: è‹±æ–‡
- `de`: å¾·è¯­
- `es`: è¥¿ç­ç‰™è¯­
- `fr`: æ³•è¯­
- `it`: æ„å¤§åˆ©è¯­
- `ja`: æ—¥è¯­
- `ko`: éŸ©è¯­
- `ru`: ä¿„è¯­
- ç­‰30å¤šç§è¯­è¨€...

### æ•°æ®å•ä½ (unit)

- `m`: å…¬åˆ¶å•ä½ï¼ˆé»˜è®¤ï¼‰
- `i`: è‹±åˆ¶å•ä½

## ğŸŒ¤ï¸ APIæ¥å£è¯¦æƒ…

### 1. å®æ—¶å¤©æ°” - GET `/api/weather`

è·å–æŒ‡å®šä½ç½®çš„å®æ—¶å¤©æ°”å’Œç©ºæ°”è´¨é‡ä¿¡æ¯ã€‚

#### è¯·æ±‚å‚æ•°

| å‚æ•°     | ç±»å‹   | å¿…é€‰ | è¯´æ˜                             | ç¤ºä¾‹                          |
| -------- | ------ | ---- | -------------------------------- | ----------------------------- |
| location | string | å¦   | ä½ç½®å‚æ•°ï¼Œä¸æä¾›åˆ™æ ¹æ®IPè‡ªåŠ¨è·å– | `101010100` æˆ– `116.41,39.92` |
| lang     | string | å¦   | å¤šè¯­è¨€è®¾ç½®ï¼Œé»˜è®¤zh               | `zh`, `en`, `ja`              |
| unit     | string | å¦   | æ•°æ®å•ä½ï¼Œé»˜è®¤m                  | `m`, `i`                      |

#### è¯·æ±‚ç¤ºä¾‹

```bash
# æ ¹æ®IPè‡ªåŠ¨è·å–ä½ç½®
GET /api/weather

# ä½¿ç”¨LocationID
GET /api/weather?location=101010100

# ä½¿ç”¨åæ ‡
GET /api/weather?location=116.41,39.92

# å®Œæ•´å‚æ•°
GET /api/weather?location=116.41,39.92&lang=en&unit=i
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "data": {
    "location": {
      "id": "101010100",
      "latitude": "39.90",
      "longitude": "116.41",
      "city": "åŒ—äº¬",
      "country": "ä¸­å›½",
      "address": "ä¸­å›½ åŒ—äº¬å¸‚ åŒ—äº¬å¸‚ åŒ—äº¬"
    },
    "weather": {
      "code": "200",
      "updateTime": "2024-01-15T10:30:00+08:00",
      "fxLink": "https://www.qweather.com/weather/beijing-101010100.html",
      "now": {
        "obsTime": "2024-01-15T10:00+08:00",
        "temp": "5",
        "feelsLike": "2",
        "icon": "100",
        "text": "æ™´",
        "wind360": "270",
        "windDir": "è¥¿é£",
        "windScale": "3",
        "windSpeed": "15",
        "humidity": "45",
        "precip": "0.0",
        "pressure": "1020",
        "vis": "10",
        "cloud": "20",
        "dew": "-5"
      },
      "refer": {
        "sources": ["QWeather"],
        "license": ["QWeather Developers License"]
      }
    },
    "air": {
      "code": "200",
      "updateTime": "2024-01-15T10:30:00+08:00",
      "fxLink": "https://www.qweather.com/air/beijing-101010100.html",
      "now": {
        "pubTime": "2024-01-15T10:00+08:00",
        "aqi": "85",
        "level": "2",
        "category": "è‰¯",
        "primary": "PM2.5",
        "pm10": "90",
        "pm25": "65",
        "no2": "40",
        "so2": "10",
        "co": "0.8",
        "o3": "120"
      },
      "refer": {
        "sources": ["QWeather"],
        "license": ["QWeather Developers License"]
      }
    },
    "updateTime": "2024-01-15T10:30:00.000Z"
  }
}
```

### 2. å¤©æ°”é¢„æŠ¥ - GET `/api/weather/forecast`

è·å–æŒ‡å®šä½ç½®çš„å¤©æ°”é¢„æŠ¥ä¿¡æ¯ï¼ˆ1-15å¤©ï¼‰ã€‚

#### è¯·æ±‚å‚æ•°

| å‚æ•°     | ç±»å‹   | å¿…é€‰ | è¯´æ˜                             | ç¤ºä¾‹                          |
| -------- | ------ | ---- | -------------------------------- | ----------------------------- |
| location | string | å¦   | ä½ç½®å‚æ•°ï¼Œä¸æä¾›åˆ™æ ¹æ®IPè‡ªåŠ¨è·å– | `101010100` æˆ– `116.41,39.92` |
| days     | number | å¦   | é¢„æŠ¥å¤©æ•°ï¼Œ1-15ï¼Œé»˜è®¤7            | `3`, `7`, `15`                |
| lang     | string | å¦   | å¤šè¯­è¨€è®¾ç½®ï¼Œé»˜è®¤zh               | `zh`, `en`, `ja`              |
| unit     | string | å¦   | æ•°æ®å•ä½ï¼Œé»˜è®¤m                  | `m`, `i`                      |

#### è¯·æ±‚ç¤ºä¾‹

```bash
# 7å¤©é¢„æŠ¥ï¼ˆé»˜è®¤ï¼‰
GET /api/weather/forecast

# 3å¤©é¢„æŠ¥
GET /api/weather/forecast?days=3

# æŒ‡å®šä½ç½®15å¤©é¢„æŠ¥
GET /api/weather/forecast?location=101010100&days=15&lang=en
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "data": {
    "location": {
      "id": "101010100",
      "latitude": "39.90",
      "longitude": "116.41",
      "city": "åŒ—äº¬",
      "country": "ä¸­å›½"
    },
    "forecast": {
      "code": "200",
      "updateTime": "2024-01-15T10:30:00+08:00",
      "fxLink": "https://www.qweather.com/weather/beijing-101010100.html",
      "daily": [
        {
          "fxDate": "2024-01-15",
          "sunrise": "07:25",
          "sunset": "17:15",
          "moonrise": "14:30",
          "moonset": "03:20",
          "moonPhase": "ä¸Šå¼¦æœˆ",
          "moonPhaseIcon": "802",
          "tempMax": "8",
          "tempMin": "-2",
          "iconDay": "100",
          "textDay": "æ™´",
          "iconNight": "150",
          "textNight": "æ™´",
          "wind360Day": "270",
          "windDirDay": "è¥¿é£",
          "windScaleDay": "3-4",
          "windSpeedDay": "20",
          "wind360Night": "270",
          "windDirNight": "è¥¿é£",
          "windScaleNight": "1-2",
          "windSpeedNight": "8",
          "humidity": "40",
          "precip": "0.0",
          "pressure": "1025",
          "vis": "10",
          "cloud": "15",
          "uvIndex": "3"
        }
      ],
      "refer": {
        "sources": ["QWeather"],
        "license": ["QWeather Developers License"]
      }
    },
    "updateTime": "2024-01-15T10:30:00.000Z"
  }
}
```

### 3. åŸå¸‚æœç´¢ - GET `/api/weather/cities`

æ ¹æ®åŸå¸‚åç§°æœç´¢åŸå¸‚ä¿¡æ¯ã€‚

#### è¯·æ±‚å‚æ•°

| å‚æ•°     | ç±»å‹   | å¿…é€‰ | è¯´æ˜                       | ç¤ºä¾‹                      |
| -------- | ------ | ---- | -------------------------- | ------------------------- |
| location | string | æ˜¯   | åŸå¸‚åç§°                   | `åŒ—äº¬`, `beijing`, `ä¸Šæµ·` |
| number   | number | å¦   | è¿”å›ç»“æœæ•°é‡ï¼Œ1-20ï¼Œé»˜è®¤10 | `5`, `10`, `20`           |
| lang     | string | å¦   | å¤šè¯­è¨€è®¾ç½®ï¼Œé»˜è®¤zh         | `zh`, `en`, `ja`          |

#### è¯·æ±‚ç¤ºä¾‹

```bash
# æœç´¢åŒ—äº¬
GET /api/weather/cities?location=åŒ—äº¬

# æœç´¢ä¸Šæµ·ï¼Œè¿”å›5ä¸ªç»“æœ
GET /api/weather/cities?location=ä¸Šæµ·&number=5

# è‹±æ–‡æœç´¢
GET /api/weather/cities?location=beijing&lang=en
```

### 4. æ‰¹é‡åŸå¸‚æœç´¢ - POST `/api/weather/cities`

æ‰¹é‡æœç´¢å¤šä¸ªåŸå¸‚ä¿¡æ¯ã€‚

#### è¯·æ±‚ä½“

```json
{
  "locations": ["åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·"],
  "number": 5,
  "lang": "zh"
}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "data": [
    {
      "query": "åŒ—äº¬",
      "success": true,
      "data": {
        "code": "200",
        "location": [
          {
            "name": "åŒ—äº¬",
            "id": "101010100",
            "lat": "39.90498",
            "lon": "116.40528",
            "adm2": "åŒ—äº¬",
            "adm1": "åŒ—äº¬å¸‚",
            "country": "ä¸­å›½",
            "tz": "Asia/Shanghai",
            "utcOffset": "+08:00",
            "isDst": "0",
            "type": "city",
            "rank": "10",
            "fxLink": "https://www.qweather.com/weather/beijing-101010100.html"
          }
        ]
      },
      "error": null
    }
  ]
}
```

## ğŸš¨ é”™è¯¯å¤„ç†

### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "success": false,
  "error": "é”™è¯¯æè¿°",
  "code": "ERROR_CODE"
}
```

### å¸¸è§é”™è¯¯ä»£ç 

| ä»£ç                       | è¯´æ˜                 |
| ------------------------- | -------------------- |
| `MISSING_API_KEY`         | æœªé…ç½®APIå¯†é’¥        |
| `INVALID_LOCATION_FORMAT` | ä½ç½®å‚æ•°æ ¼å¼é”™è¯¯     |
| `INVALID_DAYS_PARAM`      | é¢„æŠ¥å¤©æ•°å‚æ•°é”™è¯¯     |
| `INVALID_NUMBER_PARAM`    | è¿”å›ç»“æœæ•°é‡å‚æ•°é”™è¯¯ |
| `MISSING_LOCATION_PARAM`  | ç¼ºå°‘å¿…é€‰çš„ä½ç½®å‚æ•°   |
| `TOO_MANY_LOCATIONS`      | æ‰¹é‡æœç´¢åŸå¸‚æ•°é‡è¶…é™ |
| `INTERNAL_ERROR`          | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯       |

### å’Œé£å¤©æ°”APIçŠ¶æ€ç 

| ä»£ç   | è¯´æ˜                         |
| ----- | ---------------------------- |
| `200` | è¯·æ±‚æˆåŠŸ                     |
| `204` | è¯·æ±‚æˆåŠŸï¼Œä½†æŸ¥è¯¢åœ°åŒºæš‚æ— æ•°æ® |
| `400` | è¯·æ±‚é”™è¯¯                     |
| `401` | è®¤è¯å¤±è´¥                     |
| `402` | è¶…è¿‡è®¿é—®æ¬¡æ•°æˆ–ä½™é¢ä¸è¶³       |
| `403` | æ— è®¿é—®æƒé™                   |
| `404` | æŸ¥è¯¢çš„æ•°æ®æˆ–åœ°åŒºä¸å­˜åœ¨       |
| `429` | è¶…è¿‡é™å®šçš„QPM                |
| `500` | æ— å“åº”æˆ–è¶…æ—¶                 |

## ğŸ”§ ç¯å¢ƒé…ç½®

åœ¨ `.env.local` æ–‡ä»¶ä¸­é…ç½®ï¼š

```env
# å’Œé£å¤©æ°” API é…ç½®
HF_BASEURL=https://devapi.qweather.com
QWEATHER_KEY=your_qweather_api_key_here
```

## ğŸ“ ä½¿ç”¨è¯´æ˜

1. **è‡ªåŠ¨å®šä½**: å¦‚æœä¸æä¾› `location` å‚æ•°ï¼Œç³»ç»Ÿä¼šæ ¹æ®ç”¨æˆ·IPè‡ªåŠ¨è·å–åœ°ç†ä½ç½®
2. **åæ ‡ç²¾åº¦**: ç»çº¬åº¦åæ ‡æœ€å¤šæ”¯æŒå°æ•°ç‚¹åä¸¤ä½
3. **ç¼“å­˜å»ºè®®**: å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ·»åŠ é€‚å½“çš„ç¼“å­˜æœºåˆ¶
4. **é¢‘ç‡é™åˆ¶**: è¯·éµå®ˆå’Œé£å¤©æ°”APIçš„è°ƒç”¨é¢‘ç‡é™åˆ¶
5. **é”™è¯¯é‡è¯•**: å»ºè®®å®ç°é€‚å½“çš„é”™è¯¯é‡è¯•æœºåˆ¶

## ğŸ§ª æµ‹è¯•é¡µé¢

è®¿é—® `/weather-test` å¯ä»¥æµ‹è¯•æ‰€æœ‰APIåŠŸèƒ½ã€‚
