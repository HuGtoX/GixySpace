
#!/bin/sh


# è·å–æš‚å­˜åŒºå˜æ›´æ–‡ä»¶
changed_files=$(git diff --cached --name-only --diff-filter=ACM)

# æ£€æµ‹å­é¡¹ç›®å˜æ›´å¹¶åªå¯¹å˜æ›´çš„æ–‡ä»¶æ‰§è¡Œlint
run_task_for() {
  project_dir=$1
  
  # ç­›é€‰å‡ºè¯¥é¡¹ç›®ä¸‹çš„å˜æ›´æ–‡ä»¶
  project_files=$(echo "$changed_files" | grep "^$project_dir/" | grep -E '\.(js|jsx|ts|tsx)$')
  
  if [ -n "$project_files" ]; then
    echo "ğŸŸ¢ æ£€æµ‹åˆ° $project_dir å˜æ›´ï¼Œæ‰§è¡Œ lint æ£€æŸ¥..."
    
    # å°†æ–‡ä»¶åˆ—è¡¨è½¬æ¢ä¸ºç›¸å¯¹äºé¡¹ç›®ç›®å½•çš„è·¯å¾„
    relative_files=$(echo "$project_files" | sed "s|^$project_dir/||")
    
    # åªå¯¹å˜æ›´çš„æ–‡ä»¶æ‰§è¡Œlint
    (cd "$project_dir" && echo "$relative_files" | xargs npx next lint --file)
    
    if [ $? -ne 0 ]; then
      echo "âŒ Lint æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤åå†æäº¤"
      exit 1
    fi
  fi
}